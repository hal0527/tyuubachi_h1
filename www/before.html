<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <script src="components/loader.js"></script>
  <script src="lib/onsenui/js/onsenui.min.js"></script>
  <script src="js/circle.js"></script>
  <script src="js/page_event.js"></script>
  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css">
  <link rel="stylesheet" href="css/style.css">
    
     
     
   <script>
      var ncmb = new NCMB("dd411920ff7852038a3d55414c3447b88c5e842ace7268254078b113d065398c", "23304def33b24aeed4fe1ae5325a77c1ffbe3e44067c0a3716b47aefd4297e05");
     
    function snapPicture () {
        navigator.camera.getPicture (onSuccess, onFail,
            { quality: 50, destinationType: Camera.DestinationType.DATA_URL});

        //成功した際に呼ばれるコールバック関数
        function onSuccess (imageData) {
            // 画像を表示
            var image = document.getElementById ('showImage');
            image.src = "data:image/jpeg;base64," + imageData;

            var byteCharacters = toBlob(imageData);
            ncmb.File.upload("test.png", byteCharacters)
            .then(function() {
              alert("Successful");
            })
            .catch(function(error) {
              alert(JSON.stringify(error));
            });
        }

        //失敗した場合に呼ばれるコールバック関数
        function onFail (message) {
            alert ('カメラエラーです: ' + message);
        }
    }

    function toBlob(base64) {
        var bin = atob(base64.replace(/^.*,/, ''));
        var buffer = new Uint8Array(bin.length);
        for (var i = 0; i < bin.length; i++) {
            buffer[i] = bin.charCodeAt(i);
        }
        // Blobを作成
        try{
            var blob = new Blob([buffer.buffer], {
                type: 'image/png'
            });
        }catch (e){
            return false;
        }
        return blob;
    }
  </script>
    
</head>
<body>
 <ons-toolbar>
        <div class="left"><ons-back-button onclick="window.location.href='Home.html'">Back</ons-back-button></div>
        <div class="center"> TAKE A PICTURE</div>
      <div class="right"><ons-toolbar-button onclick="window.location.href='after.html'">compare</ons-toolbar-button></div>
          
      </ons-toolbar>
    <br><br><br><br>
 <div class="center">    
 <ons-button class="button" onclick="snapPicture()">Take picture and save</ons-button>
 </div>
 <br>
    <img id="showImage" width="280" height="350"/>
</html>
</body>
