<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <script src="components/loader.js"></script>
  <script src="lib/onsenui/js/onsenui.min.js"></script>
  <script src="js/circle.js"></script>
  <script src="js/page_event.js"></script>

  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="lib/onsenui/css/onsen-css-components.css">
  <link rel="stylesheet" href="css/style.css">

  <script>
    var ncmb = new NCMB("110bd92fd08b667727f46a321bb903bacc49babf679332505f8ce751c1c38ce4","19fff4af2112fbfc38b048dae80f6c5c629732e81ce1848622659c12d70c1b7b");

    ons.ready(function (){
        var test = localStorage.getItem("LoginUsername");
  
        if(test == undefined ){
          
        } else {
          window.location.href='Home.html';
        }

    });

    function login_en(){
      var input = document.getElementById("user_name").value;
      var regm = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
      if(input.match(regm)){
          LoginEmail();
      } else {
          LoginUser();
      }
    }

    function LoginEmail(){
      var input_email = document.getElementById("user_name").value;
      var input_password = document.getElementById("user_password").value;
      if(input_email == ""){
        alert("メールアドレスが入力されていません");
        return;
      } else if(input_password == ""){
        alert("パスワードが入力されていません");
        return;
      } else{
        //localStorage.clear();
        ncmb.User.loginWithMailAddress(input_email,input_password)
                 .then(function(data){
                   // ログイン後処理
                    localStorage.setItem("LoginEmail",input_email);
                    window.location.href='Home.html';
                    
                 })
                 .catch(function(err){
                   // エラー処理
                    alert("入力エラー、ログインに失敗しました：\n" + error);
                    console.log("ログインの検索に失敗しました1：\n" + error);
                    return;
                 });
    }
    }

    function LoginUser(){
      var input_username = document.getElementById("user_name").value;
      var input_password = document.getElementById("user_password").value;
      if(input_username == ""){
        alert("ユーザー名が入力されていません");
        return;
      } else if(input_password == ""){
        alert("パスワードが入力されていません");
        return;
      } else{
        //localStorage.clear();1111111
        ncmb.User.login(input_username,input_password)
                 .then(function(data){
                   // ログイン後処理
                    localStorage.setItem("LoginUsername",input_username)
                    window.location.href='Home.html';
                 })
                 .catch(function(err){
                   // エラー処理
                    alert("入力エラー、ログインに失敗しました：\n" + error);
                    console.log("ログインの検索に失敗しました1：\n" + error);
                    return;
                 });
      
      
      }   
    }



  </script>
</head>
<body>
    <div class="top-bg">
      <div class="top-div1">
        <div class="top-div2">
          <h1 class="top-title">アプリ</h1>
        </div>
      </div>
      <br />
      <br />
          <div class="center" style="width: 250px;display: inline-block;">
            <ons-list-item>
              <div style="width: 180px;font-size: 7px">メールアドレスまたはユーザー名</div>
              <ons-input type="text" id="user_name" placeholder=" Username" style=" width: 200px;"> </ons-input>
            </ons-list-item>
            <ons-list-item>
              <div style="width: 70px;font-size: 7px">パスワード</div>
                <ons-input type="password" id="user_password" placeholder=" Password" style=" width: 200px;"> </ons-input>
                <p style="font-size: 7px">パスワードを忘れた方は<a href="">再発行の手続き</a>へ</p>
              
            </ons-list-item>
          </div>
          
          <p>
            <ons-button modifier="material" onclick="login_en()" style=" width: 200px;">ログイン</ons-button>
          </p>
          <ons-button modifier="material" onclick="window.location.href='Home.html'" style=" width: 90px;">スキップ</ons-button>
          <ons-button modifier="material" onclick="window.location.href='AddUserdata.html'" style=" width: 90px;">登録</ons-button>
    </div>
    
</body>
</html>